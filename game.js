!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=i(1),r=i(9),a=i(10),s=i(11),l=function(){function e(){this.bloomFramebuffers=[],this._canvas=document.getElementsByTagName("canvas")[0]}return e.ins=function(){return null!==n&&void 0!==n||(console.log("GLContext create",n),n=new e),n},e.prototype.initContext=function(){this.ref=this.getWebGLContext(this._canvas),console.log(this.ref),this.gl=this.ref.gl,this.ext=this.ref.ext;var e=this;this.blit=function(){return e.gl.bindBuffer(e.gl.ARRAY_BUFFER,e.gl.createBuffer()),e.gl.bufferData(e.gl.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),e.gl.STATIC_DRAW),e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,e.gl.createBuffer()),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(0,2,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(0),function(t){e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,t),e.gl.drawElements(e.gl.TRIANGLES,6,e.gl.UNSIGNED_SHORT,0)}}(),this.ditheringTexture=this.createTextureAsync("LDR_LLL1_0.png");var t=new a.ShaderConfig(this.gl,this.ext,this.compileShader.bind(this));this.blurProgram=new r.Program(t.blurVertexShader,t.blurShader),this.copyProgram=new r.Program(t.baseVertexShader,t.copyShader),this.clearProgram=new r.Program(t.baseVertexShader,t.clearShader),this.colorProgram=new r.Program(t.baseVertexShader,t.colorShader),this.checkerboardProgram=new r.Program(t.baseVertexShader,t.checkerboardShader),this.bloomPrefilterProgram=new r.Program(t.baseVertexShader,t.bloomPrefilterShader),this.bloomBlurProgram=new r.Program(t.baseVertexShader,t.bloomBlurShader),this.bloomFinalProgram=new r.Program(t.baseVertexShader,t.bloomFinalShader),this.sunraysMaskProgram=new r.Program(t.baseVertexShader,t.sunraysMaskShader),this.sunraysProgram=new r.Program(t.baseVertexShader,t.sunraysShader),this.splatProgram=new r.Program(t.baseVertexShader,t.splatShader),this.advectionProgram=new r.Program(t.baseVertexShader,t.advectionShader),this.divergenceProgram=new r.Program(t.baseVertexShader,t.divergenceShader),this.curlProgram=new r.Program(t.baseVertexShader,t.curlShader),this.vorticityProgram=new r.Program(t.baseVertexShader,t.vorticityShader),this.pressureProgram=new r.Program(t.baseVertexShader,t.pressureShader),this.gradienSubtractProgram=new r.Program(t.baseVertexShader,t.gradientSubtractShader),this.displayMaterial=new s.Material(t.baseVertexShader,t.displayShaderSource),this.initFramebuffers(),this.multipleSplats(parseInt(""+20*Math.random())+5)},Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),e.prototype.resizeCanvas=function(){var e=this.scaleByPixelRatio(this._canvas.clientWidth),t=this.scaleByPixelRatio(this._canvas.clientHeight);return(this._canvas.width!==e||this._canvas.height!==t)&&(this._canvas.width=e,this._canvas.height=t,!0)},e.prototype.scaleByPixelRatio=function(e){var t=window.devicePixelRatio||1;return Math.floor(e*t)},e.prototype.getWebGLContext=function(e){var t={alpha:!0,depth:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!1},i=e.getContext("webgl2",t),n=!!i;n||(i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t));var o,r;n?(i.getExtension("EXT_color_buffer_float"),r=i.getExtension("OES_texture_float_linear")):(o=i.getExtension("OES_texture_half_float"),r=i.getExtension("OES_texture_half_float_linear")),i.clearColor(0,0,0,1);var a,s,l,c=n?i.HALF_FLOAT:o.HALF_FLOAT_OES;return n?(a=this.getSupportedFormat(i,i.RGBA16F,i.RGBA,c),s=this.getSupportedFormat(i,i.RG16F,i.RG,c),l=this.getSupportedFormat(i,i.R16F,i.RED,c)):(a=this.getSupportedFormat(i,i.RGBA,i.RGBA,c),s=this.getSupportedFormat(i,i.RGBA,i.RGBA,c),l=this.getSupportedFormat(i,i.RGBA,i.RGBA,c)),console.log("send","event",n?"webgl2":"webgl",null===a?"not supported":"supported"),{gl:i,ext:{formatRGBA:a,formatRG:s,formatR:l,halfFloatTexType:c,supportLinearFiltering:r}}},e.prototype.getSupportedFormat=function(e,t,i,n){if(!this.supportRenderTextureFormat(e,t,i,n))switch(t){case e.R16F:return this.getSupportedFormat(e,e.RG16F,e.RG,n);case e.RG16F:return this.getSupportedFormat(e,e.RGBA16F,e.RGBA,n);default:return}return{internalFormat:t,format:i}},e.prototype.supportRenderTextureFormat=function(e,t,i,n){var o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,t,4,4,0,i,n,void 0);var r=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE},e.prototype.initFramebuffers=function(){var e=this.getResolution(o.GameConfig.ins().config.SIM_RESOLUTION),t=this.getResolution(o.GameConfig.ins().config.DYE_RESOLUTION),i=this.ext.halfFloatTexType,n=this.ext.formatRGBA,r=this.ext.formatRG,a=this.ext.formatR,s=this.ext.supportLinearFiltering?this.gl.LINEAR:this.gl.NEAREST;null===this.dye||void 0===this.dye?this.dye=this.createDoubleFBO(t.width,t.height,n.internalFormat,n.format,i,s):this.dye=this.resizeDoubleFBO(this.dye,t.width,t.height,n.internalFormat,n.format,i,s),null===this.velocity||void 0===this.velocity?this.velocity=this.createDoubleFBO(e.width,e.height,r.internalFormat,r.format,i,s):this.velocity=this.resizeDoubleFBO(this.velocity,e.width,e.height,r.internalFormat,r.format,i,s),this.divergence=this.createFBO(e.width,e.height,a.internalFormat,a.format,i,this.gl.NEAREST),this.curl=this.createFBO(e.width,e.height,a.internalFormat,a.format,i,this.gl.NEAREST),this.pressure=this.createDoubleFBO(e.width,e.height,a.internalFormat,a.format,i,this.gl.NEAREST),this.initBloomFramebuffers(),this.initSunraysFramebuffers()},e.prototype.initBloomFramebuffers=function(){var e=this.getResolution(o.GameConfig.ins().config.BLOOM_RESOLUTION),t=this.ext.halfFloatTexType,i=this.ext.formatRGBA,n=this.ext.supportLinearFiltering?this.gl.LINEAR:this.gl.NEAREST;this.bloom=this.createFBO(e.width,e.height,i.internalFormat,i.format,t,n),this.bloomFramebuffers.length=0;for(var r=0;r<o.GameConfig.ins().config.BLOOM_ITERATIONS;r++){var a=e.width>>r+1,s=e.height>>r+1;if(a<2||s<2)break;var l=this.createFBO(a,s,i.internalFormat,i.format,t,n);this.bloomFramebuffers.push(l)}},e.prototype.initSunraysFramebuffers=function(){var e=this.getResolution(o.GameConfig.ins().config.SUNRAYS_RESOLUTION),t=this.ext.halfFloatTexType,i=this.ext.formatR,n=this.ext.supportLinearFiltering?this.gl.LINEAR:this.gl.NEAREST;this.sunrays=this.createFBO(e.width,e.height,i.internalFormat,i.format,t,n),this.sunraysTemp=this.createFBO(e.width,e.height,i.internalFormat,i.format,t,n)},e.prototype.getResolution=function(e){var t=this.gl.drawingBufferWidth/this.gl.drawingBufferHeight;t<1&&(t=1/t);var i=Math.round(e),n=Math.round(e*t);return this.gl.drawingBufferWidth>this.gl.drawingBufferHeight?{width:n,height:i}:{width:i,height:n}},e.prototype.createDoubleFBO=function(e,t,i,n,o,r){var a=this.createFBO(e,t,i,n,o,r),s=this.createFBO(e,t,i,n,o,r);return{width:e,height:t,texelSizeX:a.texelSizeX,texelSizeY:a.texelSizeY,get read(){return a},set read(e){a=e},get write(){return s},set write(e){s=e},swap:function(){var e=a;a=s,s=e}}},e.prototype.createFBO=function(e,t,i,n,o,r){this.gl.activeTexture(this.gl.TEXTURE0);var a=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,i,e,t,0,n,o,void 0);var s=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,a,0),this.gl.viewport(0,0,e,t),this.gl.clear(this.gl.COLOR_BUFFER_BIT);var l=1/e,c=1/t;return{texture:a,fbo:s,width:e,height:t,texelSizeX:l,texelSizeY:c,attach:function(e){return this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,a),e}.bind(this)}},e.prototype.resizeFBO=function(e,t,i,n,o,r,a){var s=this.createFBO(t,i,n,o,r,a);return this.copyProgram.bind(),this.gl.uniform1i(this.copyProgram.uniforms.uTexture,e.attach(0)),this.blit(s.fbo),s},e.prototype.resizeDoubleFBO=function(e,t,i,n,o,r,a){return e.width===t&&e.height===i?e:(e.read=this.resizeFBO(e.read,t,i,n,o,r,a),e.write=this.createFBO(t,i,n,o,r,a),e.width=t,e.height=i,e.texelSizeX=1/t,e.texelSizeY=1/i,e)},e.prototype.captureScreenshot=function(){var e=this.getResolution(o.GameConfig.ins().config.CAPTURE_RESOLUTION),t=this.createFBO(e.width,e.height,this.ext.formatRGBA.internalFormat,this.ext.formatRGBA.format,this.ext.halfFloatTexType,this.gl.NEAREST);this.render(t);var i=this.framebufferToTexture(t);i=this.normalizeTexture(i,t.width,t.height);var n=this.textureToCanvas(i,t.width,t.height),r=n.toDataURL();this.downloadURI("fluid.png",r),URL.revokeObjectURL(r)},e.prototype.downloadURI=function(e,t){var i=document.createElement("a");i.download=e,i.href=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)},e.prototype.createTextureAsync=function(e){var t=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB,1,1,0,this.gl.RGB,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255]));var i={texture:t,width:1,height:1,attach:function(e){return this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,t),e}.bind(this)},n=new Image,o=this;return n.onload=function(){i.width=n.width,i.height=n.height,o.gl.bindTexture(o.gl.TEXTURE_2D,t),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGB,o.gl.RGB,o.gl.UNSIGNED_BYTE,n)},n.src=e,i},e.prototype.compileShader=function(e,t,i){t=this.addKeywords(t,i);var n=this.gl.createShader(e);if(this.gl.shaderSource(n,t),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))throw this.gl.getShaderInfoLog(n);return n},e.prototype.createProgram=function(e,t){var i=this.gl.createProgram();if(this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw this.gl.getProgramInfoLog(i);return i},e.prototype.getUniforms=function(e){for(var t=[],i=this.gl.getProgramParameter(e,this.gl.ACTIVE_UNIFORMS),n=0;n<i;n++){var o=this.gl.getActiveUniform(e,n).name;t[o]=this.gl.getUniformLocation(e,o)}return t},e.prototype.render=function(e){o.GameConfig.ins().config.BLOOM&&this.applyBloom(this.dye.read,this.bloom),o.GameConfig.ins().config.SUNRAYS&&(this.applySunrays(this.dye.read,this.dye.write,this.sunrays),this.blur(this.sunrays,this.sunraysTemp,1)),null!==e&&o.GameConfig.ins().config.TRANSPARENT?this.gl.disable(this.gl.BLEND):(this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND));var t=null===e?this.gl.drawingBufferWidth:e.width,i=null===e?this.gl.drawingBufferHeight:e.height;this.gl.viewport(0,0,t,i);var n=null===e?null:e.fbo;o.GameConfig.ins().config.TRANSPARENT||this.drawColor(n,this.normalizeColor(o.GameConfig.ins().config.BACK_COLOR)),null===e&&o.GameConfig.ins().config.TRANSPARENT&&this.drawCheckerboard(n),this.drawDisplay(n,t,i)},e.prototype.framebufferToTexture=function(e){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.fbo);var t=e.width*e.height*4,i=new Float32Array(t);return this.gl.readPixels(0,0,e.width,e.height,this.gl.RGBA,this.gl.FLOAT,i),i},e.prototype.normalizeTexture=function(e,t,i){for(var n=new Uint8Array(e.length),o=0,r=i-1;r>=0;r--)for(var a=0;a<t;a++){var s=r*t*4+4*a;n[s+0]=255*this.clamp01(e[o+0]),n[s+1]=255*this.clamp01(e[o+1]),n[s+2]=255*this.clamp01(e[o+2]),n[s+3]=255*this.clamp01(e[o+3]),o+=4}return n},e.prototype.clamp01=function(e){return Math.min(Math.max(e,0),1)},e.prototype.normalizeColor=function(e){return{r:e.r/255,g:e.g/255,b:e.b/255}},e.prototype.drawColor=function(e,t){this.colorProgram.bind(),this.gl.uniform4f(this.colorProgram.uniforms.color,t.r,t.g,t.b,1),this.blit(e)},e.prototype.drawCheckerboard=function(e){this.checkerboardProgram.bind(),this.gl.uniform1f(this.checkerboardProgram.uniforms.aspectRatio,this._canvas.width/this._canvas.height),this.blit(e)},e.prototype.textureToCanvas=function(e,t,i){var n=document.createElement("canvas"),o=n.getContext("2d");n.width=t,n.height=i;var r=o.createImageData(t,i);return r.data.set(e),o.putImageData(r,0,0),n},e.prototype.addKeywords=function(e,t){if(null===t||void 0===t)return e;for(var i="",n=0,o=t;n<o.length;n++){i+="#define "+o[n]+"\n"}return i+e},e.prototype.applyBloom=function(e,t){if(!(this.bloomFramebuffers.length<2)){var i=t;this.gl.disable(this.gl.BLEND),this.bloomPrefilterProgram.bind();var n=o.GameConfig.ins().config.BLOOM_THRESHOLD*o.GameConfig.ins().config.BLOOM_SOFT_KNEE+1e-4,r=o.GameConfig.ins().config.BLOOM_THRESHOLD-n,a=2*n,s=.25/n;this.gl.uniform3f(this.bloomPrefilterProgram.uniforms.curve,r,a,s),this.gl.uniform1f(this.bloomPrefilterProgram.uniforms.threshold,o.GameConfig.ins().config.BLOOM_THRESHOLD),this.gl.uniform1i(this.bloomPrefilterProgram.uniforms.uTexture,e.attach(0)),this.gl.viewport(0,0,i.width,i.height),this.blit(i.fbo),this.bloomBlurProgram.bind();for(var l=0;l<this.bloomFramebuffers.length;l++){var c=this.bloomFramebuffers[l];this.gl.uniform2f(this.bloomBlurProgram.uniforms.texelSize,i.texelSizeX,i.texelSizeY),this.gl.uniform1i(this.bloomBlurProgram.uniforms.uTexture,i.attach(0)),this.gl.viewport(0,0,c.width,c.height),this.blit(c.fbo),i=c}this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.gl.enable(this.gl.BLEND);for(var u=this.bloomFramebuffers.length-2;u>=0;u--){var d=this.bloomFramebuffers[u];this.gl.uniform2f(this.bloomBlurProgram.uniforms.texelSize,i.texelSizeX,i.texelSizeY),this.gl.uniform1i(this.bloomBlurProgram.uniforms.uTexture,i.attach(0)),this.gl.viewport(0,0,d.width,d.height),this.blit(d.fbo),i=d}this.gl.disable(this.gl.BLEND),this.bloomFinalProgram.bind(),this.gl.uniform2f(this.bloomFinalProgram.uniforms.texelSize,i.texelSizeX,i.texelSizeY),this.gl.uniform1i(this.bloomFinalProgram.uniforms.uTexture,i.attach(0)),this.gl.uniform1f(this.bloomFinalProgram.uniforms.intensity,o.GameConfig.ins().config.BLOOM_INTENSITY),this.gl.viewport(0,0,t.width,t.height),this.blit(t.fbo)}},e.prototype.applySunrays=function(e,t,i){this.gl.disable(this.gl.BLEND),this.sunraysMaskProgram.bind(),this.gl.uniform1i(this.sunraysMaskProgram.uniforms.uTexture,e.attach(0)),this.gl.viewport(0,0,t.width,t.height),this.blit(t.fbo),this.sunraysProgram.bind(),this.gl.uniform1f(this.sunraysProgram.uniforms.weight,o.GameConfig.ins().config.SUNRAYS_WEIGHT),this.gl.uniform1i(this.sunraysProgram.uniforms.uTexture,t.attach(0)),this.gl.viewport(0,0,i.width,i.height),this.blit(i.fbo)},e.prototype.blur=function(e,t,i){this.blurProgram.bind();for(var n=0;n<i;n++)this.gl.uniform2f(this.blurProgram.uniforms.texelSize,e.texelSizeX,0),this.gl.uniform1i(this.blurProgram.uniforms.uTexture,e.attach(0)),this.blit(t.fbo),this.gl.uniform2f(this.blurProgram.uniforms.texelSize,0,e.texelSizeY),this.gl.uniform1i(this.blurProgram.uniforms.uTexture,t.attach(0)),this.blit(e.fbo)},e.prototype.drawDisplay=function(e,t,i){if(this.displayMaterial.bind(),o.GameConfig.ins().config.SHADING&&this.gl.uniform2f(this.displayMaterial.uniforms.texelSize,1/t,1/i),this.gl.uniform1i(this.displayMaterial.uniforms.uTexture,this.dye.read.attach(0)),o.GameConfig.ins().config.BLOOM){this.gl.uniform1i(this.displayMaterial.uniforms.uBloom,this.bloom.attach(1)),this.gl.uniform1i(this.displayMaterial.uniforms.uDithering,this.ditheringTexture.attach(2));var n=this.getTextureScale(this.ditheringTexture,t,i);this.gl.uniform2f(this.displayMaterial.uniforms.ditherScale,n.x,n.y)}o.GameConfig.ins().config.SUNRAYS&&this.gl.uniform1i(this.displayMaterial.uniforms.uSunrays,this.sunrays.attach(3)),this.blit(e)},e.prototype.getTextureScale=function(e,t,i){return{x:t/e.width,y:i/e.height}},e.prototype.multipleSplats=function(e){for(var t=0;t<e;t++){var i=this.generateColor();i.r*=10,i.g*=10,i.b*=10;var n=Math.random(),o=Math.random(),r=1e3*(Math.random()-.5),a=1e3*(Math.random()-.5);this.splat(n,o,r,a,i)}},e.prototype.splat=function(e,t,i,n,r){this.gl.viewport(0,0,this.velocity.width,this.velocity.height),this.splatProgram.bind(),this.gl.uniform1i(this.splatProgram.uniforms.uTarget,this.velocity.read.attach(0)),this.gl.uniform1f(this.splatProgram.uniforms.aspectRatio,this._canvas.width/this._canvas.height),this.gl.uniform2f(this.splatProgram.uniforms.point,e,t),this.gl.uniform3f(this.splatProgram.uniforms.color,i,n,0),this.gl.uniform1f(this.splatProgram.uniforms.radius,this.correctRadius(o.GameConfig.ins().config.SPLAT_RADIUS/100)),this.blit(this.velocity.write.fbo),this.velocity.swap(),this.gl.viewport(0,0,this.dye.width,this.dye.height),this.gl.uniform1i(this.splatProgram.uniforms.uTarget,this.dye.read.attach(0)),this.gl.uniform3f(this.splatProgram.uniforms.color,r.r,r.g,r.b),this.blit(this.dye.write.fbo),this.dye.swap()},e.prototype.correctRadius=function(e){var t=this._canvas.width/this._canvas.height;return t>1&&(e*=t),e},e.prototype.generateColor=function(){var e=this.HSVtoRGB(Math.random(),1,1);return e.r*=.15,e.g*=.15,e.b*=.15,e},e.prototype.HSVtoRGB=function(e,t,i){var n,o,r,a,s,l,c,u;switch(a=Math.floor(6*e),s=6*e-a,l=i*(1-t),c=i*(1-s*t),u=i*(1-(1-s)*t),a%6){case 0:n=i,o=u,r=l;break;case 1:n=c,o=i,r=l;break;case 2:n=l,o=i,r=u;break;case 3:n=l,o=c,r=i;break;case 4:n=u,o=l,r=i;break;case 5:n=i,o=l,r=c}return{r:n,g:o,b:r}},e.prototype.splatPointer=function(e){var t=e.deltaX*o.GameConfig.ins().config.SPLAT_FORCE,i=e.deltaY*o.GameConfig.ins().config.SPLAT_FORCE;this.splat(e.texcoordX,e.texcoordY,t,i,e.color)},e.prototype.step=function(e){this.gl.disable(this.gl.BLEND),this.gl.viewport(0,0,this.velocity.width,this.velocity.height),this.curlProgram.bind(),this.gl.uniform2f(this.curlProgram.uniforms.texelSize,this.velocity.texelSizeX,this.velocity.texelSizeY),this.gl.uniform1i(this.curlProgram.uniforms.uVelocity,this.velocity.read.attach(0)),this.blit(this.curl.fbo),this.vorticityProgram.bind(),this.gl.uniform2f(this.vorticityProgram.uniforms.texelSize,this.velocity.texelSizeX,this.velocity.texelSizeY),this.gl.uniform1i(this.vorticityProgram.uniforms.uVelocity,this.velocity.read.attach(0)),this.gl.uniform1i(this.vorticityProgram.uniforms.uCurl,this.curl.attach(1)),this.gl.uniform1f(this.vorticityProgram.uniforms.curl,o.GameConfig.ins().config.CURL),this.gl.uniform1f(this.vorticityProgram.uniforms.dt,e),this.blit(this.velocity.write.fbo),this.velocity.swap(),this.divergenceProgram.bind(),this.gl.uniform2f(this.divergenceProgram.uniforms.texelSize,this.velocity.texelSizeX,this.velocity.texelSizeY),this.gl.uniform1i(this.divergenceProgram.uniforms.uVelocity,this.velocity.read.attach(0)),this.blit(this.divergence.fbo),this.clearProgram.bind(),this.gl.uniform1i(this.clearProgram.uniforms.uTexture,this.pressure.read.attach(0)),this.gl.uniform1f(this.clearProgram.uniforms.value,o.GameConfig.ins().config.PRESSURE),this.blit(this.pressure.write.fbo),this.pressure.swap(),this.pressureProgram.bind(),this.gl.uniform2f(this.pressureProgram.uniforms.texelSize,this.velocity.texelSizeX,this.velocity.texelSizeY),this.gl.uniform1i(this.pressureProgram.uniforms.uDivergence,this.divergence.attach(0));for(var t=0;t<o.GameConfig.ins().config.PRESSURE_ITERATIONS;t++)this.gl.uniform1i(this.pressureProgram.uniforms.uPressure,this.pressure.read.attach(1)),this.blit(this.pressure.write.fbo),this.pressure.swap();this.gradienSubtractProgram.bind(),this.gl.uniform2f(this.gradienSubtractProgram.uniforms.texelSize,this.velocity.texelSizeX,this.velocity.texelSizeY),this.gl.uniform1i(this.gradienSubtractProgram.uniforms.uPressure,this.pressure.read.attach(0)),this.gl.uniform1i(this.gradienSubtractProgram.uniforms.uVelocity,this.velocity.read.attach(1)),this.blit(this.velocity.write.fbo),this.velocity.swap(),this.advectionProgram.bind(),this.gl.uniform2f(this.advectionProgram.uniforms.texelSize,this.velocity.texelSizeX,this.velocity.texelSizeY),this.ext.supportLinearFiltering||this.gl.uniform2f(this.advectionProgram.uniforms.dyeTexelSize,this.velocity.texelSizeX,this.velocity.texelSizeY);var i=this.velocity.read.attach(0);this.gl.uniform1i(this.advectionProgram.uniforms.uVelocity,i),this.gl.uniform1i(this.advectionProgram.uniforms.uSource,i),this.gl.uniform1f(this.advectionProgram.uniforms.dt,e),this.gl.uniform1f(this.advectionProgram.uniforms.dissipation,o.GameConfig.ins().config.VELOCITY_DISSIPATION),this.blit(this.velocity.write.fbo),this.velocity.swap(),this.gl.viewport(0,0,this.dye.width,this.dye.height),this.ext.supportLinearFiltering||this.gl.uniform2f(this.advectionProgram.uniforms.dyeTexelSize,this.dye.texelSizeX,this.dye.texelSizeY),this.gl.uniform1i(this.advectionProgram.uniforms.uVelocity,this.velocity.read.attach(0)),this.gl.uniform1i(this.advectionProgram.uniforms.uSource,this.dye.read.attach(1)),this.gl.uniform1f(this.advectionProgram.uniforms.dissipation,o.GameConfig.ins().config.DENSITY_DISSIPATION),this.blit(this.dye.write.fbo),this.dye.swap()},e}();t.GLContext=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(){this.config={SIM_RESOLUTION:128,DYE_RESOLUTION:1024,CAPTURE_RESOLUTION:512,DENSITY_DISSIPATION:1,VELOCITY_DISSIPATION:.2,PRESSURE:.8,PRESSURE_ITERATIONS:20,CURL:30,SPLAT_RADIUS:.25,SPLAT_FORCE:6e3,SHADING:!0,COLORFUL:!0,COLOR_UPDATE_SPEED:10,PAUSED:!1,BACK_COLOR:{r:0,g:0,b:0},TRANSPARENT:!1,BLOOM:!0,BLOOM_ITERATIONS:8,BLOOM_RESOLUTION:256,BLOOM_INTENSITY:.8,BLOOM_THRESHOLD:.6,BLOOM_SOFT_KNEE:.7,SUNRAYS:!0,SUNRAYS_RESOLUTION:196,SUNRAYS_WEIGHT:1}}return e.ins=function(){return n||(n=new e)},e}();t.GameConfig=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.id=-1,this.texcoordX=0,this.texcoordY=0,this.prevTexcoordX=0,this.prevTexcoordY=0,this.deltaX=0,this.deltaY=0,this.down=!1,this.moved=!1,this.color=[30,0,300]}return e}();t.PointerPrototype=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=i(12),r=function(){function e(){this.isWX=!1,this.isWEB=!1,this._curPlat=a.web,this.isWX=!1,this.isWEB=!1,this._curPlat,a.web,this._curPlat=a.web,this.isWEB=!0,this.p=new o.PlatformWeb}return e.ins=function(){return n||(n=new e)},e}();t.PlatMgr=r;var a;!function(e){e[e.web=1]="web"}(a||(a={}))},function(e,t,i){"use strict";i(5).Main.ins()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6),o=function(){function e(){this.lastUpdateTime=Date.now(),this.colorUpdateTimer=0,this.scene=new n.SceneMgr,this.update()}return e.ins=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.update=function(){var e=this.calcDeltaTime();this.scene&&this.scene.onTick(e),requestAnimationFrame(this.update.bind(this))},e.prototype.calcDeltaTime=function(){var e=Date.now(),t=(e-this.lastUpdateTime)/1e3;return t=Math.min(t,.016666),this.lastUpdateTime=e,t},e}();t.Main=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(7),o=i(2),r=i(0),a=i(1),s=i(3),l=function(){function e(){this.colorUpdateTimer=0,this._init()}return e.prototype.onTick=function(e){r.GLContext.ins().resizeCanvas()&&r.GLContext.ins().initFramebuffers(),this.updateColors(e),this.applyInputs(),a.GameConfig.ins().config.PAUSED||r.GLContext.ins().step(e),r.GLContext.ins().render(null)},e.prototype.updateColors=function(e){a.GameConfig.ins().config.COLORFUL&&(this.colorUpdateTimer+=e*a.GameConfig.ins().config.COLOR_UPDATE_SPEED,this.colorUpdateTimer>=1&&(this.colorUpdateTimer=this.wrap(this.colorUpdateTimer,0,1),n.Qgui.ins().pointers.forEach(function(e){e.color=r.GLContext.ins().generateColor()})))},e.prototype.applyInputs=function(){n.Qgui.ins().splatStack.length>0&&r.GLContext.ins().multipleSplats(n.Qgui.ins().splatStack.pop()),n.Qgui.ins().pointers.forEach(function(e){e.moved&&(e.moved=!1,r.GLContext.ins().splatPointer(e))})},e.prototype.wrap=function(e,t,i){var n=i-t;return 0===n?t:(e-t)%n+t},e.prototype._init=function(){r.GLContext.ins().initContext(),r.GLContext.ins().resizeCanvas(),n.Qgui.ins().pointers.push(new o.PointerPrototype),s.PlatMgr.ins().p.isMobile()&&(a.GameConfig.ins().config.DYE_RESOLUTION=512),r.GLContext.ins().ext.supportLinearFiltering||(a.GameConfig.ins().config.DYE_RESOLUTION=512,a.GameConfig.ins().config.SHADING=!1,a.GameConfig.ins().config.BLOOM=!1,a.GameConfig.ins().config.SUNRAYS=!1)},e}();t.SceneMgr=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=i(8),r=i(1),a=i(0),s=i(2),l=i(3),c=function(){function e(){this.pointers=[],this.splatStack=[],this.updateKeywords(),this.inputEvent()}return e.ins=function(){return n||(n=new e)},e.prototype.startGUI=function(){var e=this,t=new o.GUI({width:300});t.add(r.GameConfig.ins().config,"DYE_RESOLUTION",{high:1024,medium:512,low:256,"very low":128}).name("quality").onFinishChange(a.GLContext.ins().initFramebuffers.bind(a.GLContext.ins())),t.add(r.GameConfig.ins().config,"SIM_RESOLUTION",{32:32,64:64,128:128,256:256}).name("sim resolution").onFinishChange(a.GLContext.ins().initFramebuffers.bind(a.GLContext.ins())),t.add(r.GameConfig.ins().config,"DENSITY_DISSIPATION",0,4).name("density diffusion"),t.add(r.GameConfig.ins().config,"VELOCITY_DISSIPATION",0,4).name("velocity diffusion"),t.add(r.GameConfig.ins().config,"PRESSURE",0,1).name("pressure"),t.add(r.GameConfig.ins().config,"CURL",0,50).name("vorticity").step(1),t.add(r.GameConfig.ins().config,"SPLAT_RADIUS",.01,1).name("splat radius"),t.add(r.GameConfig.ins().config,"SHADING").name("shading").onFinishChange(this.updateKeywords),t.add(r.GameConfig.ins().config,"COLORFUL").name("colorful"),t.add(r.GameConfig.ins().config,"PAUSED").name("paused").listen(),t.add({fun:function(){e.splatStack.push(parseInt(""+20*Math.random())+5)}},"fun").name("Random splats");var i=t.addFolder("Bloom");i.add(r.GameConfig.ins().config,"BLOOM").name("enabled").onFinishChange(this.updateKeywords.bind(this)),i.add(r.GameConfig.ins().config,"BLOOM_INTENSITY",.1,2).name("intensity"),i.add(r.GameConfig.ins().config,"BLOOM_THRESHOLD",0,1).name("threshold");var n=t.addFolder("Sunrays");n.add(r.GameConfig.ins().config,"SUNRAYS").name("enabled").onFinishChange(this.updateKeywords.bind(this)),n.add(r.GameConfig.ins().config,"SUNRAYS_WEIGHT",.3,1).name("weight");var s=t.addFolder("Capture");s.addColor(r.GameConfig.ins().config,"BACK_COLOR").name("background color"),s.add(r.GameConfig.ins().config,"TRANSPARENT").name("transparent"),s.add({fun:a.GLContext.ins().captureScreenshot},"fun").name("take screenshot");var c=t.add({fun:function(){window.open("https://github.com/PavelDoGreat/WebGL-Fluid-Simulation"),console.log("send","event","link button","github")}},"fun").name("Github");c.__li.className="cr function bigFont",c.__li.style.borderLeft="3px solid #8C8C8C";var u=document.createElement("span");c.domElement.parentElement.appendChild(u),u.className="icon github";var d=t.add({fun:function(){console.log("send","event","link button","twitter"),window.open("https://twitter.com/PavelDoGreat")}},"fun").name("Twitter");d.__li.className="cr function bigFont",d.__li.style.borderLeft="3px solid #8C8C8C";var h=document.createElement("span");d.domElement.parentElement.appendChild(h),h.className="icon twitter";var f=t.add({fun:function(){console.log("send","event","link button","discord"),window.open("https://discordapp.com/invite/CeqZDDE")}},"fun").name("Discord");f.__li.className="cr function bigFont",f.__li.style.borderLeft="3px solid #8C8C8C";var m=document.createElement("span");f.domElement.parentElement.appendChild(m),m.className="icon discord";var g=t.add({fun:function(){console.log("send","event","link button","app"),window.open("http://onelink.to/5b58bn")}},"fun").name("Check out mobile app");g.__li.className="cr function appBigFont",g.__li.style.borderLeft="3px solid #00FF7F";var p=document.createElement("span");g.domElement.parentElement.appendChild(p),p.className="icon app",l.PlatMgr.ins().p.isMobile()&&t.close()},e.prototype.updateKeywords=function(){var e=[];r.GameConfig.ins().config.SHADING&&e.push("SHADING"),r.GameConfig.ins().config.BLOOM&&e.push("BLOOM"),r.GameConfig.ins().config.SUNRAYS&&e.push("SUNRAYS"),a.GLContext.ins().displayMaterial.setKeywords(e)},e.prototype.inputEvent=function(){var t=this;a.GLContext.ins().canvas.addEventListener("mousedown",function(t){for(var i=a.GLContext.ins().scaleByPixelRatio(t.offsetX),n=a.GLContext.ins().scaleByPixelRatio(t.offsetY),o=null,r=0,l=e.ins().pointers;r<l.length;r++){var c=l[r];if(-1===c.id){o=c;break}}null===o&&(o=new s.PointerPrototype),this.updatePointerDownData(o,-1,i,n)}.bind(this)),a.GLContext.ins().canvas.addEventListener("mousemove",function(t){var i=e.ins().pointers[0];if(i.down){var n=a.GLContext.ins().scaleByPixelRatio(t.offsetX),o=a.GLContext.ins().scaleByPixelRatio(t.offsetY);this.updatePointerMoveData(i,n,o)}}.bind(this)),window.addEventListener("mouseup",function(){t.updatePointerUpData(t.pointers[0])}),a.GLContext.ins().canvas.addEventListener("touchstart",function(e){e.preventDefault();for(var t=e.targetTouches;t.length>=this.pointers.length;)this.pointers.push(new s.PointerPrototype);for(var i=0;i<t.length;i++){var n=a.GLContext.ins().scaleByPixelRatio(t[i].pageX),o=a.GLContext.ins().scaleByPixelRatio(t[i].pageY);this.updatePointerDownData(this.pointers[i+1],t[i].identifier,n,o)}}.bind(this)),a.GLContext.ins().canvas.addEventListener("touchmove",function(e){e.preventDefault();for(var t=e.targetTouches,i=0;i<t.length;i++){var n=this.pointers[i+1];if(n.down){var o=a.GLContext.ins().scaleByPixelRatio(t[i].pageX),r=a.GLContext.ins().scaleByPixelRatio(t[i].pageY);this.updatePointerMoveData(n,o,r)}}}.bind(this),!1),window.addEventListener("touchend",function(e){for(var t=e.changedTouches,i=0;i<t.length;i++)!function(e){var i=this.pointers.find(function(i){return i.id===t[e].identifier});null!==i&&this.updatePointerUpData(i)}(i)}.bind(this)),window.addEventListener("keydown",function(e){"KeyP"===e.code&&(r.GameConfig.ins().config.PAUSED=!r.GameConfig.ins().config.PAUSED)," "===e.key&&t.splatStack.push(parseInt(String(20*Math.random()))+5)}.bind(this))},e.prototype.updatePointerDownData=function(e,t,i,n){e.id=t,e.down=!0,e.moved=!1,e.texcoordX=i/a.GLContext.ins().canvas.width,e.texcoordY=1-n/a.GLContext.ins().canvas.height,e.prevTexcoordX=e.texcoordX,e.prevTexcoordY=e.texcoordY,e.deltaX=0,e.deltaY=0,e.color=a.GLContext.ins().generateColor()},e.prototype.updatePointerMoveData=function(e,t,i){e.prevTexcoordX=e.texcoordX,e.prevTexcoordY=e.texcoordY,e.texcoordX=t/a.GLContext.ins().canvas.width,e.texcoordY=1-i/a.GLContext.ins().canvas.height,e.deltaX=this.correctDeltaX(e.texcoordX-e.prevTexcoordX),e.deltaY=this.correctDeltaY(e.texcoordY-e.prevTexcoordY),e.moved=Math.abs(e.deltaX)>0||Math.abs(e.deltaY)>0},e.prototype.updatePointerUpData=function(e){e.down=!1},e.prototype.correctDeltaX=function(e){var t=a.GLContext.ins().canvas.width/a.GLContext.ins().canvas.height;return t<1&&(e*=t),e},e.prototype.correctDeltaY=function(e){var t=a.GLContext.ins().canvas.width/a.GLContext.ins().canvas.height;return t>1&&(e/=t),e},e}();t.Qgui=c},function(e,t,i){"use strict";var n,o,r,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i,s){"object"==a(t)&&void 0!==e?s(t):(o=[t],n=s,void 0!==(r="function"==typeof n?n.apply(t,o):n)&&(e.exports=r))}(0,function(e){function t(e,t){var i=e.__state.conversionName.toString(),n=Math.round(e.r),o=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===i?"rgb("+n+","+o+","+r+")":"CSS_RGBA"===i?"rgba("+n+","+o+","+r+","+a+")":"HEX"===i?"0x"+e.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+o+","+r+"]":"RGBA_ARRAY"===i?"["+n+","+o+","+r+","+a+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+o+",b:"+r+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+o+",b:"+r+",a:"+a+"}":"HSV_OBJ"===i?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===i?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}function i(e,t,i){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(z.recalculateRGB(this,t,i),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(z.recalculateRGB(this,t,i),this.__state.space="RGB"),this.__state[t]=e}})}function n(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(z.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(z.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function o(e){if("0"===e||A.isUndefined(e))return 0;var t=e.match(W);return A.isNull(t)?0:parseFloat(t[1])}function r(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}function s(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}function l(e,t,i,n,o){return n+(e-t)/(i-t)*(o-n)}function c(e,t,i,n){e.style.background="",A.each(te,function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+i+" 0%, "+n+" 100%); "})}function u(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function d(e,t,i){var n=document.createElement("li");return t&&n.appendChild(t),i?e.__ul.insertBefore(n,i):e.__ul.appendChild(n),e.onResize(),n}function h(e){j.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&j.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function f(e,t){var i=e.__preset_select[e.__preset_select.selectedIndex];i.innerHTML=t?i.value+"*":i.value}function m(e,t,i){if(i.__li=t,i.__gui=e,A.extend(i,{options:function(t){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),p(e,i.object,i.property,{before:n,factoryArgs:[A.toArray(arguments)]})}if(A.isArray(t)||A.isObject(t)){var o=i.__li.nextElementSibling;return i.remove(),p(e,i.object,i.property,{before:o,factoryArgs:[t]})}},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof Z){var n=new J(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});A.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=i[e],o=n[e];i[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(n,e),t.apply(i,e)}}),j.addClass(t,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof J){var o=function(t){if(A.isNumber(i.__min)&&A.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,o=i.__gui.__listening.indexOf(i)>-1;i.remove();var r=p(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return r.name(n),o&&r.listen(),r}return t};i.min=A.compose(o,i.min),i.max=A.compose(o,i.max)}else i instanceof Y?(j.bind(t,"click",function(){j.fakeEvent(i.__checkbox,"click")}),j.bind(i.__checkbox,"click",function(e){e.stopPropagation()})):i instanceof $?(j.bind(t,"click",function(){j.fakeEvent(i.__button,"click")}),j.bind(t,"mouseover",function(){j.addClass(i.__button,"hover")}),j.bind(t,"mouseout",function(){j.removeClass(i.__button,"hover")})):i instanceof ee&&(j.addClass(t,"color"),i.updateDisplay=A.compose(function(e){return t.style.borderLeftColor=i.__color.toString(),e},i.updateDisplay),i.updateDisplay());i.setValue=A.compose(function(t){return e.getRoot().__preset_select&&i.isModified()&&f(e.getRoot(),!0),t},i.setValue)}function g(e,t){var i=e.getRoot(),n=i.__rememberedObjects.indexOf(t.object);if(-1!==n){var o=i.__rememberedObjectIndecesToControllers[n];if(void 0===o&&(o={},i.__rememberedObjectIndecesToControllers[n]=o),o[t.property]=t,i.load&&i.load.remembered){var r=i.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[se])return;a=r[se]}if(a[n]&&void 0!==a[n][t.property]){var s=a[n][t.property];t.initialValue=s,t.setValue(s)}}}}function p(e,t,i,n){if(void 0===t[i])throw new Error('Object "'+t+'" has no property "'+i+'"');var o=void 0;if(n.color)o=new ee(t,i);else{var r=[t,i].concat(n.factoryArgs);o=ne.apply(e,r)}n.before instanceof H&&(n.before=n.before.__li),g(e,o),j.addClass(o.domElement,"c");var a=document.createElement("span");j.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var l=d(e,s,n.before);return j.addClass(l,me.CLASS_CONTROLLER_ROW),o instanceof ee?j.addClass(l,"color"):j.addClass(l,k(o.getValue())),m(e,l,o),e.__controllers.push(o),o}function v(e,t){return document.location.href+"."+t}function _(e,t,i){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),i&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function b(e,t){t.style.display=e.useLocalStorage?"block":"none"}function y(e){var t=e.__save_row=document.createElement("li");j.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),j.addClass(t,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",j.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",j.addClass(n,"button"),j.addClass(n,"save");var o=document.createElement("span");o.innerHTML="New",j.addClass(o,"button"),j.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",j.addClass(r,"button"),j.addClass(r,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?A.each(e.load.remembered,function(t,i){_(e,i,i===e.preset)}):_(e,se,!1),j.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(i),t.appendChild(n),t.appendChild(o),t.appendChild(r),le){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(v(e,"isLocal"))&&l.setAttribute("checked","checked"),b(e,s),j.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,b(e,s)})}var c=document.getElementById("dg-new-constructor");j.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||ce.hide()}),j.bind(i,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),ce.show(),c.focus(),c.select()}),j.bind(n,"click",function(){e.save()}),j.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),j.bind(r,"click",function(){e.revert()})}function w(e){function t(t){return t.preventDefault(),e.width+=o-t.clientX,e.onResize(),o=t.clientX,!1}function i(){j.removeClass(e.__closeButton,me.CLASS_DRAG),j.unbind(window,"mousemove",t),j.unbind(window,"mouseup",i)}function n(n){return n.preventDefault(),o=n.clientX,j.addClass(e.__closeButton,me.CLASS_DRAG),j.bind(window,"mousemove",t),j.bind(window,"mouseup",i),!1}var o=void 0;e.__resize_handle=document.createElement("div"),A.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),j.bind(e.__resize_handle,"mousedown",n),j.bind(e.__closeButton,"mousedown",n),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function x(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function E(e,t){var i={};return A.each(e.__rememberedObjects,function(n,o){var r={},a=e.__rememberedObjectIndecesToControllers[o];A.each(a,function(e,i){r[i]=t?e.initialValue:e.getValue()}),i[o]=r}),i}function S(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function T(e){0!==e.length&&oe.call(window,function(){T(e)}),A.each(e,function(e){e.updateDisplay()})}var C=Array.prototype.forEach,R=Array.prototype.slice,A={BREAK:{},extend:function(e){return this.each(R.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(t[i])||(e[i]=t[i])}.bind(this))},this),e},defaults:function(e){return this.each(R.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(e[i])&&(e[i]=t[i])}.bind(this))},this),e},compose:function(){var e=R.call(arguments);return function(){for(var t=R.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(e)if(C&&e.forEach&&e.forEach===C)e.forEach(t,i);else if(e.length===e.length+0){var n=void 0,o=void 0;for(n=0,o=e.length;n<o;n++)if(n in e&&t.call(i,e[n],n)===this.BREAK)return}else for(var r in e)if(t.call(i,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var n=void 0;return function(){var o=this,r=arguments,a=i||!n;clearTimeout(n),n=setTimeout(function(){n=null,i||e.apply(o,r)},t),a&&e.apply(o,r)}},toArray:function(e){return e.toArray?e.toArray():R.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},O=[{litmus:A.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:t},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:t}}},{litmus:A.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:A.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:A.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(A.isNumber(e.r)&&A.isNumber(e.g)&&A.isNumber(e.b)&&A.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(A.isNumber(e.r)&&A.isNumber(e.g)&&A.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(A.isNumber(e.h)&&A.isNumber(e.s)&&A.isNumber(e.v)&&A.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(A.isNumber(e.h)&&A.isNumber(e.s)&&A.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],P=void 0,D=void 0,L=function(){D=!1;var e=arguments.length>1?A.toArray(arguments):arguments[0];return A.each(O,function(t){if(t.litmus(e))return A.each(t.conversions,function(t,i){if(P=t.read(e),!1===D&&!1!==P)return D=P,P.conversionName=i,P.conversion=t,A.BREAK}),A.BREAK}),D},F=void 0,B={hsv_to_rgb:function(e,t,i){var n=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),r=i*(1-t),a=i*(1-o*t),s=i*(1-(1-o)*t),l=[[i,s,r],[a,i,r],[r,i,s],[r,a,i],[s,r,i],[i,r,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,i){var n=Math.min(e,t,i),o=Math.max(e,t,i),r=o-n,a=void 0,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=r/o,a=e===o?(t-i)/r:t===o?2+(i-e)/r:4+(e-t)/r,(a/=6)<0&&(a+=1),{h:360*a,s:s,v:o/255})},rgb_to_hex:function(e,t,i){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,i)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,i){return i<<(F=8*t)|e&~(255<<F)}},k="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},G=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},U=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),N=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},I=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},M=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t},z=function(){function e(){if(G(this,e),this.__state=L.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return U(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();z.recalculateRGB=function(e,t,i){if("HEX"===e.__state.space)e.__state[t]=B.component_from_hex(e.__state.hex,i);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");A.extend(e.__state,B.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},z.recalculateHSV=function(e){var t=B.rgb_to_hsv(e.r,e.g,e.b);A.extend(e.__state,{s:t.s,v:t.v}),A.isNaN(t.h)?A.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},z.COMPONENTS=["r","g","b","h","s","v","hex","a"],i(z.prototype,"r",2),i(z.prototype,"g",1),i(z.prototype,"b",0),n(z.prototype,"h"),n(z.prototype,"s"),n(z.prototype,"v"),Object.defineProperty(z.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(z.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=B.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var H=function(){function e(t,i){G(this,e),this.initialValue=t[i],this.domElement=document.createElement("div"),this.object=t,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return U(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),V={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},X={};A.each(V,function(e,t){A.each(e,function(e){X[e]=t})});var W=/(\d+(\.\d+)?)px/,j={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var n=i,o=t;A.isUndefined(o)&&(o=!0),A.isUndefined(n)&&(n=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,n){var o=i||{},r=X[t];if(!r)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":var s=o.x||o.clientX||0,l=o.y||o.clientY||0;a.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;A.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(t,o.bubbles||!1,o.cancelable||!0)}A.defaults(a,n),e.dispatchEvent(a)},bind:function(e,t,i,n){var o=n||!1;return e.addEventListener?e.addEventListener(t,i,o):e.attachEvent&&e.attachEvent("on"+t,i),j},unbind:function(e,t,i,n){var o=n||!1;return e.removeEventListener?e.removeEventListener(t,i,o):e.detachEvent&&e.detachEvent("on"+t,i),j},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1===i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return j},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),n=i.indexOf(t);-1!==n&&(i.splice(n,1),e.className=i.join(" "))}else e.className=void 0;return j},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return o(t["border-left-width"])+o(t["border-right-width"])+o(t["padding-left"])+o(t["padding-right"])+o(t.width)},getHeight:function(e){var t=getComputedStyle(e);return o(t["border-top-width"])+o(t["border-bottom-width"])+o(t["padding-top"])+o(t["padding-bottom"])+o(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do{i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent}while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Y=function(e){function t(e,i){G(this,t);var n=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),o=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),j.bind(n.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return I(t,H),U(t,[{key:"setValue",value:function(e){var i=N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),K=function(e){function t(e,i,n){G(this,t);var o=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),r=n,a=o;if(o.__select=document.createElement("select"),A.isArray(r)){var s={};A.each(r,function(e){s[e]=e}),r=s}return A.each(r,function(e,t){var i=document.createElement("option");i.innerHTML=t,i.setAttribute("value",e),a.__select.appendChild(i)}),o.updateDisplay(),j.bind(o.__select,"change",function(){var e=this.options[this.selectedIndex].value;a.setValue(e)}),o.domElement.appendChild(o.__select),o}return I(t,H),U(t,[{key:"setValue",value:function(e){var i=N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return j.isActive(this.__select)?this:(this.__select.value=this.getValue(),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),Q=function(e){function t(e,i){function n(){r.setValue(r.__input.value)}G(this,t);var o=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),r=o;return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),j.bind(o.__input,"keyup",n),j.bind(o.__input,"change",n),j.bind(o.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),j.bind(o.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return I(t,H),U(t,[{key:"updateDisplay",value:function(){return j.isActive(this.__input)||(this.__input.value=this.getValue()),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),q=function(e){function t(e,i,n){G(this,t);var o=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=n||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,A.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=r(o.__impliedStep),o}return I(t,H),U(t,[{key:"setValue",value:function(e){var i=e;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=r(e),this}}]),t}(),J=function(e){function t(e,i,n){function o(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function r(e){var t=c-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep),c=e.clientY}function a(){j.unbind(window,"mousemove",r),j.unbind(window,"mouseup",a),o()}G(this,t);var s=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));s.__truncationSuspended=!1;var l=s,c=void 0;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),j.bind(s.__input,"change",function(){var e=parseFloat(l.__input.value);A.isNaN(e)||l.setValue(e)}),j.bind(s.__input,"blur",function(){o()}),j.bind(s.__input,"mousedown",function(e){j.bind(window,"mousemove",r),j.bind(window,"mouseup",a),c=e.clientY}),j.bind(s.__input,"keydown",function(e){13===e.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,o())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return I(t,q),U(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():s(this.getValue(),this.__precision),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),Z=function(e){function t(e,i,n,o,r){function a(e){e.preventDefault();var t=h.__background.getBoundingClientRect();return h.setValue(l(e.clientX,t.left,t.right,h.__min,h.__max)),!1}function s(){j.unbind(window,"mousemove",a),j.unbind(window,"mouseup",s),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function c(e){var t=e.touches[0].clientX,i=h.__background.getBoundingClientRect();h.setValue(l(t,i.left,i.right,h.__min,h.__max))}function u(){j.unbind(window,"touchmove",c),j.unbind(window,"touchend",u),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}G(this,t);var d=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,{min:n,max:o,step:r})),h=d;return d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),j.bind(d.__background,"mousedown",function(e){document.activeElement.blur(),j.bind(window,"mousemove",a),j.bind(window,"mouseup",s),a(e)}),j.bind(d.__background,"touchstart",function(e){1===e.touches.length&&(j.bind(window,"touchmove",c),j.bind(window,"touchend",u),c(e))}),j.addClass(d.__background,"slider"),j.addClass(d.__foreground,"slider-fg"),d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return I(t,q),U(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),$=function(e){function t(e,i,n){G(this,t);var o=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===n?"Fire":n,j.bind(o.__button,"click",function(e){return e.preventDefault(),r.fire(),!1}),j.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return I(t,H),U(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),ee=function(e){function t(e,i){function n(e){d(e),j.bind(window,"mousemove",d),j.bind(window,"touchmove",d),j.bind(window,"mouseup",r),j.bind(window,"touchend",r)}function o(e){h(e),j.bind(window,"mousemove",h),j.bind(window,"touchmove",h),j.bind(window,"mouseup",a),j.bind(window,"touchend",a)}function r(){j.unbind(window,"mousemove",d),j.unbind(window,"touchmove",d),j.unbind(window,"mouseup",r),j.unbind(window,"touchend",r),l()}function a(){j.unbind(window,"mousemove",h),j.unbind(window,"touchmove",h),j.unbind(window,"mouseup",a),j.unbind(window,"touchend",a),l()}function s(){var e=L(this.value);!1!==e?(m.__color.__state=e,m.setValue(m.__color.toOriginal())):this.value=m.__color.toString()}function l(){m.__onFinishChange&&m.__onFinishChange.call(m,m.__color.toOriginal())}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=m.__saturation_field.getBoundingClientRect(),i=e.touches&&e.touches[0]||e,n=i.clientX,o=i.clientY,r=(n-t.left)/(t.right-t.left),a=1-(o-t.top)/(t.bottom-t.top);return a>1?a=1:a<0&&(a=0),r>1?r=1:r<0&&(r=0),m.__color.v=a,m.__color.s=r,m.setValue(m.__color.toOriginal()),!1}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=m.__hue_field.getBoundingClientRect(),i=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),m.__color.h=360*i,m.setValue(m.__color.toOriginal()),!1}G(this,t);var f=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));f.__color=new z(f.getValue()),f.__temp=new z(0);var m=f;f.domElement=document.createElement("div"),j.makeSelectable(f.domElement,!1),f.__selector=document.createElement("div"),f.__selector.className="selector",f.__saturation_field=document.createElement("div"),f.__saturation_field.className="saturation-field",f.__field_knob=document.createElement("div"),f.__field_knob.className="field-knob",f.__field_knob_border="2px solid ",f.__hue_knob=document.createElement("div"),f.__hue_knob.className="hue-knob",f.__hue_field=document.createElement("div"),f.__hue_field.className="hue-field",f.__input=document.createElement("input"),f.__input.type="text",f.__input_textShadow="0 1px 1px ",j.bind(f.__input,"keydown",function(e){13===e.keyCode&&s.call(this)}),j.bind(f.__input,"blur",s),j.bind(f.__selector,"mousedown",function(){j.addClass(this,"drag").bind(window,"mouseup",function(){j.removeClass(m.__selector,"drag")})}),j.bind(f.__selector,"touchstart",function(){j.addClass(this,"drag").bind(window,"touchend",function(){j.removeClass(m.__selector,"drag")})});var g=document.createElement("div");return A.extend(f.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),A.extend(f.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:f.__field_knob_border+(f.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),A.extend(f.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),A.extend(f.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),A.extend(g.style,{width:"100%",height:"100%",background:"none"}),c(g,"top","rgba(0,0,0,0)","#000"),A.extend(f.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),u(f.__hue_field),A.extend(f.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:f.__input_textShadow+"rgba(0,0,0,0.7)"}),j.bind(f.__saturation_field,"mousedown",n),j.bind(f.__saturation_field,"touchstart",n),j.bind(f.__field_knob,"mousedown",n),j.bind(f.__field_knob,"touchstart",n),j.bind(f.__hue_field,"mousedown",o),j.bind(f.__hue_field,"touchstart",o),f.__saturation_field.appendChild(g),f.__selector.appendChild(f.__field_knob),f.__selector.appendChild(f.__saturation_field),f.__selector.appendChild(f.__hue_field),f.__hue_field.appendChild(f.__hue_knob),f.domElement.appendChild(f.__input),f.domElement.appendChild(f.__selector),f.updateDisplay(),f}return I(t,H),U(t,[{key:"updateDisplay",value:function(){var e=L(this.getValue());if(!1!==e){var t=!1;A.each(z.COMPONENTS,function(i){if(!A.isUndefined(e[i])&&!A.isUndefined(this.__color.__state[i])&&e[i]!==this.__color.__state[i])return t=!0,{}},this),t&&A.extend(this.__color.__state,e)}A.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;A.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,c(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),A.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),t}(),te=["-moz-","-o-","-webkit-","-ms-",""],ie={load:function(e,t){var i=t||document,n=i.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,i.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var i=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e;var o=i.getElementsByTagName("head")[0];try{o.appendChild(n)}catch(e){}}},ne=function(e,t){var i=e[t];return A.isArray(arguments[2])||A.isObject(arguments[2])?new K(e,t,arguments[2]):A.isNumber(i)?A.isNumber(arguments[2])&&A.isNumber(arguments[3])?A.isNumber(arguments[4])?new Z(e,t,arguments[2],arguments[3],arguments[4]):new Z(e,t,arguments[2],arguments[3]):A.isNumber(arguments[4])?new J(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new J(e,t,{min:arguments[2],max:arguments[3]}):A.isString(i)?new Q(e,t):A.isFunction(i)?new $(e,t,""):A.isBoolean(i)?new Y(e,t):null},oe=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},re=function(){function e(){G(this,e),this.backgroundElement=document.createElement("div"),A.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),j.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),A.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;j.bind(this.backgroundElement,"click",function(){t.hide()})}return U(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),A.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",j.unbind(e.domElement,"webkitTransitionEnd",t),j.unbind(e.domElement,"transitionend",t),j.unbind(e.domElement,"oTransitionEnd",t)};j.bind(this.domElement,"webkitTransitionEnd",t),j.bind(this.domElement,"transitionend",t),j.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-j.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-j.getHeight(this.domElement)/2+"px"}}]),e}(),ae=function(e){if("undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ie.inject(ae);var se="Default",le=function(){try{return!!window.localStorage}catch(e){return!1}}(),ce=void 0,ue=!0,de=void 0,he=!1,fe=[],me=function e(t){var i=this,n=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),j.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=A.defaults(n,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),n=A.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),A.isUndefined(n.load)?n.load={preset:se}:n.preset&&(n.load.preset=n.preset),A.isUndefined(n.parent)&&n.hideable&&fe.push(this),n.resizable=A.isUndefined(n.parent)&&n.resizable,n.autoPlace&&A.isUndefined(n.scrollable)&&(n.scrollable=!0);var o=le&&"true"===localStorage.getItem(v(this,"isLocal")),r=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(e){i.parent?i.getRoot().preset=e:n.load.preset=e,S(this),i.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,x(i,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,a&&(a.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(t){n.closed=t,n.closed?j.addClass(i.__ul,e.CLASS_CLOSED):j.removeClass(i.__ul,e.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(e){le&&(o=e,e?j.bind(window,"unload",r):j.unbind(window,"unload",r),localStorage.setItem(v(i,"isLocal"),e))}}}),A.isUndefined(n.parent)){if(n.closed=!1,j.addClass(this.domElement,e.CLASS_MAIN),j.makeSelectable(this.domElement,!1),le&&o){i.useLocalStorage=!0;var s=localStorage.getItem(v(this,"gui"));s&&(n.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,j.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),n.closeOnTop?(j.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(j.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),j.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===n.closed&&(n.closed=!0);var l=document.createTextNode(n.name);j.addClass(l,"controller-name"),a=d(i,l),j.addClass(this.__ul,e.CLASS_CLOSED),j.addClass(a,"title"),j.bind(a,"click",function(e){return e.preventDefault(),i.closed=!i.closed,!1}),n.closed||(this.closed=!1)}n.autoPlace&&(A.isUndefined(n.parent)&&(ue&&(de=document.createElement("div"),j.addClass(de,"dg"),j.addClass(de,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(de),ue=!1),de.appendChild(this.domElement),j.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||x(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},j.bind(window,"resize",this.__resizeHandler),j.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),j.bind(this.__ul,"transitionend",this.__resizeHandler),j.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&w(this),r=function(){le&&"true"===localStorage.getItem(v(i,"isLocal"))&&localStorage.setItem(v(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=r,n.parent||function(){var e=i.getRoot();e.width+=1,A.defer(function(){e.width-=1})}()};me.toggleHide=function(){he=!he,A.each(fe,function(e){e.domElement.style.display=he?"none":""})},me.CLASS_AUTO_PLACE="a",me.CLASS_AUTO_PLACE_CONTAINER="ac",me.CLASS_MAIN="main",me.CLASS_CONTROLLER_ROW="cr",me.CLASS_TOO_TALL="taller-than-window",me.CLASS_CLOSED="closed",me.CLASS_CLOSE_BUTTON="close-button",me.CLASS_CLOSE_TOP="close-top",me.CLASS_CLOSE_BOTTOM="close-bottom",me.CLASS_DRAG="drag",me.DEFAULT_WIDTH=245,me.TEXT_CLOSED="Close Controls",me.TEXT_OPEN="Open Controls",me._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||me.toggleHide()},j.bind(window,"keydown",me._keydownHandler,!1),A.extend(me.prototype,{add:function(e,t){return p(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return p(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;A.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&de.removeChild(this.domElement);var e=this;A.each(this.__folders,function(t){e.removeFolder(t)}),j.unbind(window,"keydown",me._keydownHandler,!1),h(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new me(t);this.__folders[e]=i;var n=d(this,i.domElement);return j.addClass(n,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],h(e);var t=this;A.each(e.__folders,function(t){e.removeFolder(t)}),A.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=j.getOffset(e.__ul).top,i=0;A.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(i+=j.getHeight(t))}),window.innerHeight-t-20<i?(j.addClass(e.domElement,me.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(j.removeClass(e.domElement,me.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&A.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:A.debounce(function(){this.onResize()},50),remember:function(){if(A.isUndefined(ce)&&((ce=new re).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;A.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&y(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&x(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=E(this)),e.folders={},A.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=E(this),f(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[se]=E(this,!0)),this.load.remembered[e]=E(this),this.preset=e,_(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){A.each(this.__controllers,function(t){this.getRoot().load.remembered?g(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),A.each(this.__folders,function(e){e.revert(e)}),e||f(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&T(this.__listening)},updateDisplay:function(){A.each(this.__controllers,function(e){e.updateDisplay()}),A.each(this.__folders,function(e){e.updateDisplay()})}});var ge={Color:z,math:B,interpret:L},pe={Controller:H,BooleanController:Y,OptionController:K,StringController:Q,NumberController:q,NumberControllerBox:J,NumberControllerSlider:Z,FunctionController:$,ColorController:ee},ve={dom:j},_e={GUI:me},be=me,ye={color:ge,controllers:pe,dom:ve,gui:_e,GUI:be};e.color=ge,e.controllers=pe,e.dom=ve,e.gui=_e,e.GUI=be,e.default=ye,Object.defineProperty(e,"__esModule",{value:!0})})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=function(){function e(e,t){this.uniforms={},this.program=n.GLContext.ins().createProgram(e,t),this.uniforms=n.GLContext.ins().getUniforms(this.program)}return e.prototype.bind=function(){n.GLContext.ins().gl.useProgram(this.program)},e}();t.Program=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,i){this.baseVertexShader=i(e.VERTEX_SHADER,"\n    precision highp float;\n\n    attribute vec2 aPosition;\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform vec2 texelSize;\n\n    void main () {\n        vUv = aPosition * 0.5 + 0.5;\n        vL = vUv - vec2(texelSize.x, 0.0);\n        vR = vUv + vec2(texelSize.x, 0.0);\n        vT = vUv + vec2(0.0, texelSize.y);\n        vB = vUv - vec2(0.0, texelSize.y);\n        gl_Position = vec4(aPosition, 0.0, 1.0);\n    }\n"),this.blurVertexShader=i(e.VERTEX_SHADER,"\n    precision highp float;\n\n    attribute vec2 aPosition;\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    uniform vec2 texelSize;\n\n    void main () {\n        vUv = aPosition * 0.5 + 0.5;\n        float offset = 1.33333333;\n        vL = vUv - texelSize * offset;\n        vR = vUv + texelSize * offset;\n        gl_Position = vec4(aPosition, 0.0, 1.0);\n    }\n"),this.blurShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    uniform sampler2D uTexture;\n\n    void main () {\n        vec4 sum = texture2D(uTexture, vUv) * 0.29411764;\n        sum += texture2D(uTexture, vL) * 0.35294117;\n        sum += texture2D(uTexture, vR) * 0.35294117;\n        gl_FragColor = sum;\n    }\n"),this.copyShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    uniform sampler2D uTexture;\n\n    void main () {\n        gl_FragColor = texture2D(uTexture, vUv);\n    }\n"),this.clearShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float value;\n\n    void main () {\n        gl_FragColor = value * texture2D(uTexture, vUv);\n    }\n"),this.colorShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n\n    uniform vec4 color;\n\n    void main () {\n        gl_FragColor = color;\n    }\n"),this.checkerboardShader=i(e.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float aspectRatio;\n\n    #define SCALE 25.0\n\n    void main () {\n        vec2 uv = floor(vUv * SCALE * vec2(aspectRatio, 1.0));\n        float v = mod(uv.x + uv.y, 2.0);\n        v = v * 0.1 + 0.8;\n        gl_FragColor = vec4(vec3(v), 1.0);\n    }\n"),this.displayShaderSource="\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uTexture;\n    uniform sampler2D uBloom;\n    uniform sampler2D uSunrays;\n    uniform sampler2D uDithering;\n    uniform vec2 ditherScale;\n    uniform vec2 texelSize;\n\n    vec3 linearToGamma (vec3 color) {\n        color = max(color, vec3(0));\n        return max(1.055 * pow(color, vec3(0.416666667)) - 0.055, vec3(0));\n    }\n\n    void main () {\n        vec3 c = texture2D(uTexture, vUv).rgb;\n\n    #ifdef SHADING\n        vec3 lc = texture2D(uTexture, vL).rgb;\n        vec3 rc = texture2D(uTexture, vR).rgb;\n        vec3 tc = texture2D(uTexture, vT).rgb;\n        vec3 bc = texture2D(uTexture, vB).rgb;\n\n        float dx = length(rc) - length(lc);\n        float dy = length(tc) - length(bc);\n\n        vec3 n = normalize(vec3(dx, dy, length(texelSize)));\n        vec3 l = vec3(0.0, 0.0, 1.0);\n\n        float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);\n        c *= diffuse;\n    #endif\n\n    #ifdef BLOOM\n        vec3 bloom = texture2D(uBloom, vUv).rgb;\n    #endif\n\n    #ifdef SUNRAYS\n        float sunrays = texture2D(uSunrays, vUv).r;\n        c *= sunrays;\n    #ifdef BLOOM\n        bloom *= sunrays;\n    #endif\n    #endif\n\n    #ifdef BLOOM\n        float noise = texture2D(uDithering, vUv * ditherScale).r;\n        noise = noise * 2.0 - 1.0;\n        bloom += noise / 255.0;\n        bloom = linearToGamma(bloom);\n        c += bloom;\n    #endif\n\n        float a = max(c.r, max(c.g, c.b));\n        gl_FragColor = vec4(c, a);\n    }\n",this.bloomPrefilterShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform vec3 curve;\n    uniform float threshold;\n\n    void main () {\n        vec3 c = texture2D(uTexture, vUv).rgb;\n        float br = max(c.r, max(c.g, c.b));\n        float rq = clamp(br - curve.x, 0.0, curve.y);\n        rq = curve.z * rq * rq;\n        c *= max(rq, br - threshold) / max(br, 0.0001);\n        gl_FragColor = vec4(c, 0.0);\n    }\n"),this.bloomBlurShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uTexture;\n\n    void main () {\n        vec4 sum = vec4(0.0);\n        sum += texture2D(uTexture, vL);\n        sum += texture2D(uTexture, vR);\n        sum += texture2D(uTexture, vT);\n        sum += texture2D(uTexture, vB);\n        sum *= 0.25;\n        gl_FragColor = sum;\n    }\n"),this.bloomFinalShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uTexture;\n    uniform float intensity;\n\n    void main () {\n        vec4 sum = vec4(0.0);\n        sum += texture2D(uTexture, vL);\n        sum += texture2D(uTexture, vR);\n        sum += texture2D(uTexture, vT);\n        sum += texture2D(uTexture, vB);\n        sum *= 0.25;\n        gl_FragColor = sum * intensity;\n    }\n"),this.sunraysMaskShader=i(e.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n\n    void main () {\n        vec4 c = texture2D(uTexture, vUv);\n        float br = max(c.r, max(c.g, c.b));\n        c.a = 1.0 - min(max(br * 20.0, 0.0), 0.8);\n        gl_FragColor = c;\n    }\n"),this.sunraysShader=i(e.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTexture;\n    uniform float weight;\n\n    #define ITERATIONS 16\n\n    void main () {\n        float Density = 0.3;\n        float Decay = 0.95;\n        float Exposure = 0.7;\n\n        vec2 coord = vUv;\n        vec2 dir = vUv - 0.5;\n\n        dir *= 1.0 / float(ITERATIONS) * Density;\n        float illuminationDecay = 1.0;\n\n        float color = texture2D(uTexture, vUv).a;\n\n        for (int i = 0; i < ITERATIONS; i++)\n        {\n            coord -= dir;\n            float col = texture2D(uTexture, coord).a;\n            color += col * illuminationDecay * weight;\n            illuminationDecay *= Decay;\n        }\n\n        gl_FragColor = vec4(color * Exposure, 0.0, 0.0, 1.0);\n    }\n"),this.splatShader=i(e.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uTarget;\n    uniform float aspectRatio;\n    uniform vec3 color;\n    uniform vec2 point;\n    uniform float radius;\n\n    void main () {\n        vec2 p = vUv - point.xy;\n        p.x *= aspectRatio;\n        vec3 splat = exp(-dot(p, p) / radius) * color;\n        vec3 base = texture2D(uTarget, vUv).xyz;\n        gl_FragColor = vec4(base + splat, 1.0);\n    }\n"),this.advectionShader=i(e.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uSource;\n    uniform vec2 texelSize;\n    uniform vec2 dyeTexelSize;\n    uniform float dt;\n    uniform float dissipation;\n\n    vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {\n        vec2 st = uv / tsize - 0.5;\n\n        vec2 iuv = floor(st);\n        vec2 fuv = fract(st);\n\n        vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);\n        vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);\n        vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);\n        vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);\n\n        return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);\n    }\n\n    void main () {\n    #ifdef MANUAL_FILTERING\n        vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize;\n        vec4 result = bilerp(uSource, coord, dyeTexelSize);\n    #else\n        vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n        vec4 result = texture2D(uSource, coord);\n    #endif\n        float decay = 1.0 + dissipation * dt;\n        gl_FragColor = result / decay;\n    }",t.supportLinearFiltering?null:["MANUAL_FILTERING"]),this.divergenceShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uVelocity;\n\n    void main () {\n        float L = texture2D(uVelocity, vL).x;\n        float R = texture2D(uVelocity, vR).x;\n        float T = texture2D(uVelocity, vT).y;\n        float B = texture2D(uVelocity, vB).y;\n\n        vec2 C = texture2D(uVelocity, vUv).xy;\n        if (vL.x < 0.0) { L = -C.x; }\n        if (vR.x > 1.0) { R = -C.x; }\n        if (vT.y > 1.0) { T = -C.y; }\n        if (vB.y < 0.0) { B = -C.y; }\n\n        float div = 0.5 * (R - L + T - B);\n        gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n    }\n"),this.curlShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uVelocity;\n\n    void main () {\n        float L = texture2D(uVelocity, vL).y;\n        float R = texture2D(uVelocity, vR).y;\n        float T = texture2D(uVelocity, vT).x;\n        float B = texture2D(uVelocity, vB).x;\n        float vorticity = R - L - T + B;\n        gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\n    }\n"),this.vorticityShader=i(e.FRAGMENT_SHADER,"\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vUv;\n    varying vec2 vL;\n    varying vec2 vR;\n    varying vec2 vT;\n    varying vec2 vB;\n    uniform sampler2D uVelocity;\n    uniform sampler2D uCurl;\n    uniform float curl;\n    uniform float dt;\n\n    void main () {\n        float L = texture2D(uCurl, vL).x;\n        float R = texture2D(uCurl, vR).x;\n        float T = texture2D(uCurl, vT).x;\n        float B = texture2D(uCurl, vB).x;\n        float C = texture2D(uCurl, vUv).x;\n\n        vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n        force /= length(force) + 0.0001;\n        force *= curl * C;\n        force.y *= -1.0;\n\n        vec2 vel = texture2D(uVelocity, vUv).xy;\n        gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\n    }\n"),this.pressureShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uPressure;\n    uniform sampler2D uDivergence;\n\n    void main () {\n        float L = texture2D(uPressure, vL).x;\n        float R = texture2D(uPressure, vR).x;\n        float T = texture2D(uPressure, vT).x;\n        float B = texture2D(uPressure, vB).x;\n        float C = texture2D(uPressure, vUv).x;\n        float divergence = texture2D(uDivergence, vUv).x;\n        float pressure = (L + R + B + T - divergence) * 0.25;\n        gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n    }\n"),this.gradientSubtractShader=i(e.FRAGMENT_SHADER,"\n    precision mediump float;\n    precision mediump sampler2D;\n\n    varying highp vec2 vUv;\n    varying highp vec2 vL;\n    varying highp vec2 vR;\n    varying highp vec2 vT;\n    varying highp vec2 vB;\n    uniform sampler2D uPressure;\n    uniform sampler2D uVelocity;\n\n    void main () {\n        float L = texture2D(uPressure, vL).x;\n        float R = texture2D(uPressure, vR).x;\n        float T = texture2D(uPressure, vT).x;\n        float B = texture2D(uPressure, vB).x;\n        vec2 velocity = texture2D(uVelocity, vUv).xy;\n        velocity.xy -= vec2(R - L, T - B);\n        gl_FragColor = vec4(velocity, 0.0, 1.0);\n    }\n")}return e}();t.ShaderConfig=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=function(){function e(e,t){this.vertexShader=void 0,this.fragmentShaderSource=void 0,this.programs=[],this.activeProgram=void 0,this.uniforms=[],this.bind=function(){n.GLContext.ins().gl.useProgram(this.activeProgram)},this.vertexShader=e,this.fragmentShaderSource=t,this.programs=[],this.activeProgram=void 0,this.uniforms=[]}return e.prototype.setKeywords=function(e){for(var t=0,i=0,o=e;i<o.length;i++){var r=o[i];t+=this.hashCode(r)}var a=this.programs[t];if(void 0===a){var s=n.GLContext.ins().compileShader(n.GLContext.ins().gl.FRAGMENT_SHADER,this.fragmentShaderSource,e);a=n.GLContext.ins().createProgram(this.vertexShader,s),this.programs[t]=a}a!==this.activeProgram&&(this.uniforms=n.GLContext.ins().getUniforms(a),this.activeProgram=a)},e.prototype.hashCode=function(e){if(0===e.length)return 0;for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t},e}();t.Material=o},function(e,t,i){"use strict";var n=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=i(13),r=function(e){function t(){var t=e.call(this)||this;return t.SERVER_ROOT="https://newkztq.chaosuduokai.com/index.php",t.isIphoneX=!1,t.isIOS=!1,t.isAndroid=!1,t.windowWidth=0,t.windowHeight=0,t.devicePixelRatio=0,t.safeAreaTop=0,t.safeAreaBottom=0,t.uiScaleFactor=0,t.screenSize={},t.uiScreenSize={},t._hasHighStatusbar=!1,t}return n(t,e),t.prototype.init=function(){this._initHtml(),console.log("palt init");var e=this.getQueryString("platform");console.log("pltStr",e),"ios"===e?this.isIOS=!0:this.isAndroid=!0,this.windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.devicePixelRatio=window.devicePixelRatio?window.devicePixelRatio:1,this.safeAreaTop=0,this.safeAreaBottom=0,this.screenSize={width:this.windowWidth*this.devicePixelRatio,height:this.windowHeight*this.devicePixelRatio,top:0,bottom:0},this.uiScaleFactor=o.DESIGN_WIDTH/this.windowWidth,this.uiScreenSize={width:o.DESIGN_WIDTH,height:this.windowHeight*this.uiScaleFactor,top:0,bottom:0},this.uiScreenSize.top=this.screenSize.height/this.uiScreenSize.height*this.screenSize.top,this.uiScreenSize.bottom=this.screenSize.height/this.uiScreenSize.height*this.screenSize.bottom,console.log("screenSize",this.screenSize),console.log("uiScreenSize",this.uiScreenSize),console.log("uiScaleFactor",this.uiScaleFactor),this._hasHighStatusbar=!1},t.prototype._initHtml=function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};var e=document.body.style;e.margin=0,e.overflow="hidden",e["-webkit-user-select"]="none",e["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var t=document.getElementsByTagName("meta"),i=0,n=!1,o="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";i<t.length;){var r=t[i];if("viewport"===r.name){r.content=o,n=!0;break}i++}if(!n){var r=document.createElement("meta");r.name="viewport",r.content=o,document.getElementsByTagName("head")[0].appendChild(r)}},t.prototype.absoluteStyle=function(e){if(e&&e.style){var t=e.style;t.position="absolute",t.top=t.left="0px",t.background="#000000"}},t.prototype.getInfo=function(){var e="";e+=" "+document.body.clientWidth+"\n",e+=" "+document.body.clientHeight+"\n",e+=" "+document.body.offsetWidth+" ()\n",e+=" "+document.body.offsetHeight+" ()\n",e+=" "+document.body.scrollWidth+"\n",e+=" "+document.body.scrollHeight+"\n",e+=" (ff)"+document.body.scrollTop+"\n",e+=" (ie)"+document.documentElement.scrollTop+"\n",e+=" "+document.body.scrollLeft+"\n",e+=" "+window.screenTop+"\n",e+=" "+window.screen.height+"\n",e+=" "+window.screen.width+"\n",e+=" "+window.screen.availHeight+"\n",e+=" "+window.screen.availWidth+"\n",e+="  "+window.screen.colorDepth+" \n",e+="  "+window.screen.deviceXDPI+" /\n",console.log(e),console.log("OS ",this.getOS(),":",this.getDigits()),console.log("getBrowser",this.getBrowser())},t.prototype.getOS=function(){var e=navigator.userAgent.toLowerCase(),t="Win32"===navigator.platform||"Win64"===navigator.platform||"wow64"===navigator.platform,i="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(i)return"Mac";if("X11"===navigator.platform&&!t&&!i)return"Unix";var n=String(navigator.platform).indexOf("Linux")>-1,o="android"===e.toLowerCase().match(/android/i);if(n)return o?"Android":"Linux";if(t){if(e.indexOf("Windows nt 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Win2000";if(e.indexOf("Windows nt 5.1")>-1||e.indexOf("Windows XP")>-1)return"WinXP";if(e.indexOf("Windows nt 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Win2003";if(e.indexOf("Windows nt 6.0")>-1||e.indexOf("Windows Vista")>-1)return"WinVista";if(e.indexOf("Windows nt 6.1")>-1||e.indexOf("Windows 7")>-1)return"Win7";if(e.indexOf("windows nt 6.2")>-1||e.indexOf("Windows 8")>-1)return"Win8";if(e.indexOf("windows nt 10.0")>-1||e.indexOf("Windows 10")>-1)return"Win10"}return""},t.prototype.getDigits=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("win64")>-1||e.indexOf("wow64")>-1?"64":"32"},t.prototype.getBrowser=function(){var e,t,i=/(msie\s|trident\/7)([\w\.]+)/,n=/(trident)\/([\w.]+)/,o=/(chrome)\/([\w.]+)/,r=/(firefox)\/([\w.]+)/,a=/(opera).+version\/([\w.]+)/,s=/(opr)\/(.+)/,l=/(chrome)\/([\w.]+)/,c=/(chrome)\/([\w.]+)/,u=/(chrome)\/([\w.]+)/,d=/(chrome)\/([\w.]+)/,h=/(chrome)\/([\w.]+)/,f=/version\/([\w.]+).*(safari)/,m=navigator.userAgent.toLowerCase();if(null!==(e=i.exec(m))){if(null===(t=n.exec(m)))return{browser:"Microsoft IE",version:"IE:"+e[2]||"0"};switch(t[2]){case"4.0":return{browser:"Microsoft IE",version:"IE: 8"};case"5.0":return{browser:"Microsoft IE",version:"IE: 9"};case"6.0":return{browser:"Microsoft IE",version:"IE: 10"};case"7.0":return{browser:"Microsoft IE",version:"IE: 11"};default:return{browser:"Microsoft IE",version:"Undefined"}}}return null===(e=o.exec(m))||window.attachEvent?null===(e=c.exec(m))||window.attachEvent?null===(e=r.exec(m))||window.attachEvent?null===(e=a.exec(m))||window.attachEvent?null===(e=u.exec(m))||window.attachEvent?null===(e=d.exec(m))||window.attachEvent?null===(e=h.exec(m))||window.attachEvent?null===(e=f.exec(m))||window.attachEvent||window.chrome||window.opera?(e=l.exec(m),null===e||window.attachEvent?void 0:(t=s.exec(m),null===t?{browser:"",version:"Chrome/"+e[2]||"0"}:{browser:"Opera",version:"opr/"+t[2]||"0"})):{browser:"Safari",version:"Safari/"+e[1]||"0"}:{browser:"QQ",version:"Chrome/"+e[2]||"0"}:{browser:"2345",version:"Chrome/ "+e[2]||"0"}:{browser:"",version:"Chrome/"+e[2]||"0"}:{browser:"Opera",version:"Chrome/"+e[2]||"0"}:{browser:"",version:"Firefox/"+e[2]||"0"}:{browser:"UC",version:"Chrome/"+e[2]||"0"}:{browser:"Microsoft Edge",version:"Chrome/"+e[2]||"0"}},t.prototype.getQueryString=function(e){console.log("getQueryString",name,window.location.search);for(var t=window.location.search.substring(1),i=t.split("&"),n=0,o=i;n<o.length;n++){var r=o[n],a=r.split("=");if(a[0]===e)return a[1]}},t.prototype.isMobile=function(){return/Mobi|Android/i.test(navigator.userAgent)},t}(o.PlatformBase);t.PlatformWeb=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DESIGN_WIDTH=750;var n=function(){function e(){this.SERVER_ROOT="https://newkztq.chaosuduokai.com/index.php",this.isIphoneX=!1,this.isIOS=!1,this.isAndroid=!1,this.windowWidth=0,this.windowHeight=0,this.devicePixelRatio=0,this.safeAreaTop=0,this.safeAreaBottom=0,this.uiScaleFactor=0,this.screenSize={},this.uiScreenSize={},this._hasHighStatusbar=!1,console.log("init platform info")}return e.prototype.init=function(){this._initHtml(),console.log("palt init");var e=this.getQueryString("platform");console.log("pltStr",e),"ios"===e?this.isIOS=!0:this.isAndroid=!0,this.windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.devicePixelRatio=window.devicePixelRatio?window.devicePixelRatio:1,this.safeAreaTop=0,this.safeAreaBottom=0,this.screenSize={width:this.windowWidth*this.devicePixelRatio,height:this.windowHeight*this.devicePixelRatio,top:0,bottom:0},this.uiScaleFactor=t.DESIGN_WIDTH/this.windowWidth,this.uiScreenSize={width:t.DESIGN_WIDTH,height:this.windowHeight*this.uiScaleFactor,top:0,bottom:0},this.uiScreenSize.top=this.screenSize.height/this.uiScreenSize.height*this.screenSize.top,this.uiScreenSize.bottom=this.screenSize.height/this.uiScreenSize.height*this.screenSize.bottom,console.log("screenSize",this.screenSize),console.log("uiScreenSize",this.uiScreenSize),console.log("uiScaleFactor",this.uiScaleFactor),this._hasHighStatusbar=!1},e.prototype._initHtml=function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};var e=document.body.style;e.margin=0,e.overflow="hidden",e["-webkit-user-select"]="none",e["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var t=document.getElementsByTagName("meta"),i=0,n=!1,o="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";i<t.length;){var r=t[i];if("viewport"===r.name){r.content=o,n=!0;break}i++}if(!n){var r=document.createElement("meta");r.name="viewport",r.content=o,document.getElementsByTagName("head")[0].appendChild(r)}},e.prototype.absoluteStyle=function(e){if(e&&e.style){var t=e.style;t.position="absolute",t.top=t.left="0px",t.background="#000000"}},e.prototype.getInfo=function(){var e="";e+=" "+document.body.clientWidth+"\n",e+=" "+document.body.clientHeight+"\n",e+=" "+document.body.offsetWidth+" ()\n",e+=" "+document.body.offsetHeight+" ()\n",e+=" "+document.body.scrollWidth+"\n",e+=" "+document.body.scrollHeight+"\n",e+=" (ff)"+document.body.scrollTop+"\n",e+=" (ie)"+document.documentElement.scrollTop+"\n",e+=" "+document.body.scrollLeft+"\n",e+=" "+window.screenTop+"\n",e+=" "+window.screen.height+"\n",e+=" "+window.screen.width+"\n",e+=" "+window.screen.availHeight+"\n",e+=" "+window.screen.availWidth+"\n",e+="  "+window.screen.colorDepth+" \n",e+="  "+window.screen.deviceXDPI+" /\n",console.log(e),console.log("OS ",this.getOS(),":",this.getDigits()),console.log("getBrowser",this.getBrowser())},e.prototype.getOS=function(){var e=navigator.userAgent.toLowerCase(),t="Win32"===navigator.platform||"Win64"===navigator.platform||"wow64"===navigator.platform,i="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(i)return"Mac";if("X11"===navigator.platform&&!t&&!i)return"Unix";var n=String(navigator.platform).indexOf("Linux")>-1,o="android"===e.toLowerCase().match(/android/i);if(n)return o?"Android":"Linux";if(t){if(e.indexOf("Windows nt 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Win2000";if(e.indexOf("Windows nt 5.1")>-1||e.indexOf("Windows XP")>-1)return"WinXP";if(e.indexOf("Windows nt 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Win2003";if(e.indexOf("Windows nt 6.0")>-1||e.indexOf("Windows Vista")>-1)return"WinVista";if(e.indexOf("Windows nt 6.1")>-1||e.indexOf("Windows 7")>-1)return"Win7";if(e.indexOf("windows nt 6.2")>-1||e.indexOf("Windows 8")>-1)return"Win8";if(e.indexOf("windows nt 10.0")>-1||e.indexOf("Windows 10")>-1)return"Win10"}return""},e.prototype.getDigits=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("win64")>-1||e.indexOf("wow64")>-1?"64":"32"},e.prototype.getBrowser=function(){var e,t,i=/(msie\s|trident\/7)([\w\.]+)/,n=/(trident)\/([\w.]+)/,o=/(chrome)\/([\w.]+)/,r=/(firefox)\/([\w.]+)/,a=/(opera).+version\/([\w.]+)/,s=/(opr)\/(.+)/,l=/(chrome)\/([\w.]+)/,c=/(chrome)\/([\w.]+)/,u=/(chrome)\/([\w.]+)/,d=/(chrome)\/([\w.]+)/,h=/(chrome)\/([\w.]+)/,f=/version\/([\w.]+).*(safari)/,m=navigator.userAgent.toLowerCase();if(null!==(e=i.exec(m))){if(null===(t=n.exec(m)))return{browser:"Microsoft IE",version:"IE:"+e[2]||"0"};switch(t[2]){case"4.0":return{browser:"Microsoft IE",version:"IE: 8"};case"5.0":return{browser:"Microsoft IE",version:"IE: 9"};case"6.0":return{browser:"Microsoft IE",version:"IE: 10"};case"7.0":return{browser:"Microsoft IE",version:"IE: 11"};default:return{browser:"Microsoft IE",version:"Undefined"}}}return null===(e=o.exec(m))||window.attachEvent?null===(e=c.exec(m))||window.attachEvent?null===(e=r.exec(m))||window.attachEvent?null===(e=a.exec(m))||window.attachEvent?null===(e=u.exec(m))||window.attachEvent?null===(e=d.exec(m))||window.attachEvent?null===(e=h.exec(m))||window.attachEvent?null===(e=f.exec(m))||window.attachEvent||window.chrome||window.opera?(e=l.exec(m),null===e||window.attachEvent?void 0:(t=s.exec(m),null===t?{browser:"",version:"Chrome/"+e[2]||"0"}:{browser:"Opera",version:"opr/"+t[2]||"0"})):{browser:"Safari",version:"Safari/"+e[1]||"0"}:{browser:"QQ",version:"Chrome/"+e[2]||"0"}:{browser:"2345",version:"Chrome/ "+e[2]||"0"}:{browser:"",version:"Chrome/"+e[2]||"0"}:{browser:"Opera",version:"Chrome/"+e[2]||"0"}:{browser:"",version:"Firefox/"+e[2]||"0"}:{browser:"UC",version:"Chrome/"+e[2]||"0"}:{browser:"Microsoft Edge",version:"Chrome/"+e[2]||"0"}},e.prototype.getQueryString=function(e){console.log("getQueryString",name,window.location.search);for(var t=window.location.search.substring(1),i=t.split("&"),n=0,o=i;n<o.length;n++){var r=o[n],a=r.split("=");if(a[0]===e)return a[1]}},e.prototype.isMobile=function(){return/Mobi|Android/i.test(navigator.userAgent)},e}();t.PlatformBase=n}]);